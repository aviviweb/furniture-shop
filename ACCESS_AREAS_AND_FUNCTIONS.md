# אזורי כניסה ופונקציות - Furniture SaaS Platform

## סקירה כללית
האפליקציה כוללת **3 אזורי כניסה עיקריים** עם **5 רמות הרשאה** שונות.

---

## 🎯 אזורי כניסה עיקריים

### 1. אזור ציבורי (Public Store) - `/store`
**גישה:** ללא התחברות (פתוח לכולם)

**URL:** `https://your-domain.com/store`

**פונקציות:**
- ✅ עיון במוצרים (רק מוצרים עם מלאי > 0)
- ✅ צפייה בפרטי מוצר
- ✅ הוספה לעגלת קניות
- ✅ ניהול עגלת קניות
- ✅ יצירת הזמנה (Checkout)
- ✅ צפייה בהיסטוריית הזמנות
- ✅ ניהול רשימת משאלות (Wishlist)
- ✅ חישוב משלוח (Shipping Calculator)
- ✅ תצוגת תמונות מוצרים
- ✅ סינון וחיפוש מוצרים

**הגבלות:**
- ❌ לא יכול לראות מוצרים ללא מלאי
- ❌ לא יכול לערוך מחירים או מוצרים
- ❌ לא יכול לגשת לדשבורד הניהול

---

### 2. אזור ניהול (Admin Dashboard) - `/` (דשבורד)
**גישה:** דורש התחברות עם email/password

**URL:** `https://your-domain.com/` או `https://your-domain.com/login`

**רמות הרשאה:**
1. **SUPER_ADMIN** - מנהל מערכת עליון
2. **OWNER** - בעלים
3. **ADMIN** - מנהל
4. **STAFF** - עובד
5. **INSTALLER** - מתקין

---

## 👤 פונקציות לפי רמת הרשאה

### SUPER_ADMIN (מנהל מערכת עליון)
**גישה מלאה לכל הפונקציות + ניהול מערכת**

**פונקציות:**
- ✅ כל הפונקציות של OWNER
- ✅ ניהול מצב דמו (`/superadmin`)
- ✅ איפוס נתוני דמו
- ✅ גישה לכל החברות (Multi-tenant)
- ✅ ניהול משתמשים בכל החברות

---

### OWNER (בעלים)
**גישה מלאה לכל הפונקציות הניהוליות**

**פונקציות:**

#### ניהול מוצרים (`/products`)
- ✅ יצירת מוצרים חדשים
- ✅ עריכת מוצרים קיימים
- ✅ מחיקת מוצרים
- ✅ הוספת תמונות למוצרים
- ✅ ניהול וריאנטים (SKU, מחיר, מלאי)
- ✅ הגדרת מע"מ לכל variant
- ✅ ניהול Attributes (`/products/attributes`)
  - יצירת attributes חדשים (צבע, גודל, חומר, וכו')
  - ניהול ערכים לכל attribute
  - הגדרת attributes כקבועים או דינמיים

#### ניהול מלאי (`/inventory`)
- ✅ צפייה בכל המלאי
- ✅ עדכון כמות מלאי
- ✅ הגדרת סף מינימום (minThreshold)
- ✅ ניהול מיקומים (locations)
- ✅ הוספת תנועות מלאי (IN/OUT/ADJUSTMENT/RETURN)
- ✅ צפייה בהיסטוריית תנועות
- ✅ התראות מלאי נמוך

#### ניהול לקוחות (`/customers`)
- ✅ יצירת לקוחות חדשים
- ✅ עריכת פרטי לקוחות
- ✅ מחיקת לקוחות (רק אם אין הזמנות)
- ✅ חיפוש לקוחות
- ✅ צפייה בסטטיסטיקות לקוח
- ✅ צפייה בהזמנות של לקוח

#### ניהול הזמנות (`/orders`)
- ✅ יצירת הזמנות חדשות
- ✅ עריכת הזמנות
- ✅ צפייה בכל ההזמנות
- ✅ ניהול עלויות משלוח והרכבה
- ✅ חישוב מע"מ
- ✅ הפחתת מלאי אוטומטית

#### ניהול חשבוניות (`/invoices`)
- ✅ יצירת חשבוניות (TAX, TAX_RECEIPT, PROFORMA, CREDIT)
- ✅ עריכת חשבוניות
- ✅ מספור אוטומטי רציף
- ✅ חישוב מע"מ אוטומטי
- ✅ שמירת PDF ו-JSON

#### ניהול הוצאות (`/expenses`)
- ✅ העלאת קבצי הוצאות
- ✅ עיבוד OCR אוטומטי
- ✅ ניהול קטגוריות
- ✅ צפייה בכל ההוצאות

#### ניהול משלוחים (`/deliveries`)
- ✅ יצירת משלוחים חדשים מהזמנות
- ✅ עריכת משלוחים
- ✅ עדכון סטטוס משלוח
- ✅ ניהול נהג ומתקין
- ✅ ניהול עלויות משלוח (בסיס, מרחק, קומה, מורכבות)
- ✅ ניהול עלויות הרכבה (בסיס, מורכבות)
- ✅ אופטימיזציית מסלול (mock)

#### אזור מתקין (`/installer`)
- ✅ צפייה בלוח זמנים
- ✅ עדכון סטטוס התקנה
- ✅ העלאת תמונות (לפני/אחרי)
- ✅ ניהול פרטי מתקין
- ✅ ניהול הערות

#### דוחות (`/reports`)
- ✅ דוח מכירות (מפורט, חודשי)
- ✅ דוח מלאי (עם התראות)
- ✅ דוח כספי (הכנסות, הוצאות, רווח)

#### הגדרות (`/settings`)
- ✅ ניהול הגדרות כלליות
  - מע"מ ברירת מחדל
  - מחיר משלוח בסיסי
  - תוספת לכל ק"מ
  - תוספת לכל קומה
  - מחיר הרכבה בסיסי
- ✅ ניהול מיתוג (`/settings/branding`)
  - צבע ראשי
  - צבע משני
  - לוגו
  - דומיין

---

### ADMIN (מנהל)
**גישה מלאה לכל הפונקציות הניהוליות (ללא SuperAdmin)**

**פונקציות:**
- ✅ כל הפונקציות של OWNER
- ❌ לא יכול לגשת ל-`/superadmin`
- ❌ לא יכול לנהל מצב דמו

---

### STAFF (עובד)
**גישה מוגבלת לפונקציות יומיומיות**

**פונקציות:**
- ✅ צפייה במוצרים
- ✅ עדכון מלאי (כמות, מיקום)
- ✅ צפייה בלקוחות
- ✅ יצירת הזמנות
- ✅ יצירת חשבוניות
- ✅ צפייה במשלוחים
- ✅ עדכון סטטוס משלוח
- ❌ לא יכול למחוק מוצרים/לקוחות
- ❌ לא יכול לשנות הגדרות
- ❌ לא יכול לגשת לדוחות כספיים

---

### INSTALLER (מתקין)
**גישה מוגבלת לאזור המתקין בלבד**

**פונקציות:**
- ✅ צפייה בלוח זמנים (`/installer`)
- ✅ עדכון סטטוס התקנה
- ✅ העלאת תמונות התקנה
- ✅ ניהול הערות
- ❌ לא יכול לגשת לדשבורד הראשי
- ❌ לא יכול לראות מוצרים, לקוחות, הזמנות

---

## 🔐 אימות והרשאות

### התחברות
**Endpoint:** `POST /api/auth/login`

**URL:** `https://your-domain.com/login`

**פרמטרים:**
- `email` - אימייל המשתמש
- `password` - סיסמה
- `tenantId` (אופציונלי) - אם יש מספר חברות

**תגובה:**
```json
{
  "token": "JWT_TOKEN",
  "role": "OWNER"
}
```

**אחרי התחברות:**
- ה-token נשמר ב-localStorage
- המשתמש מועבר לדשבורד (`/`)
- כל ה-API calls כוללים את ה-token ב-header

### JWT Token
- **תוקף:** 7 ימים
- **מכיל:** `userId`, `role`, `tenantId`
- **שימוש:** נשלח ב-header: `Authorization: Bearer <token>`

### משתמשים ברירת מחדל (מ-seed)
**לאחר הרצת seed:**
- **SUPER_ADMIN:** `super@platform.local` / `changeme`
- **OWNER:** `owner1@demo.local` / `changeme`
- **OWNER:** `owner2@demo.local` / `changeme`

---

## 📍 מבנה URLs

### אזור ציבורי
- `/store` - דף בית החנות
- `/store/products` - רשימת מוצרים
- `/store/products/[id]` - פרטי מוצר
- `/store/cart` - עגלת קניות
- `/store/checkout` - תהליך רכישה
- `/store/orders` - היסטוריית הזמנות
- `/store/orders/[id]` - פרטי הזמנה
- `/store/wishlist` - רשימת משאלות

### אזור ניהול (דורש התחברות)
- `/` - דשבורד ראשי
- `/login` - התחברות
- `/products` - ניהול מוצרים
- `/products/attributes` - ניהול Attributes
- `/inventory` - ניהול מלאי
- `/customers` - ניהול לקוחות
- `/orders` - ניהול הזמנות
- `/orders/new` - יצירת הזמנה חדשה
- `/orders/[id]` - פרטי הזמנה
- `/orders/[id]/edit` - עריכת הזמנה
- `/invoices` - ניהול חשבוניות
- `/invoices/new` - יצירת חשבונית חדשה
- `/invoices/[id]` - פרטי חשבונית
- `/invoices/[id]/edit` - עריכת חשבונית
- `/expenses` - ניהול הוצאות
- `/deliveries` - ניהול משלוחים
- `/installer` - אזור מתקין
- `/reports` - דוחות
- `/settings` - הגדרות כלליות
- `/settings/branding` - מיתוג
- `/superadmin` - מנהל מערכת (SUPER_ADMIN בלבד)

### אזור ציבורי נוסף
- `/landing` - דף נחיתה (Landing Page)
- `/` (ללא התחברות) - דף נחיתה או redirect ל-`/store`

---

## 🔒 אבטחה והגבלות

### Tenant Isolation
- כל משתמש שייך ל-company אחת (tenantId)
- כל הנתונים מבודדים לפי tenantId
- לא ניתן לגשת לנתונים של חברות אחרות

### Password Security
- **Production:** רק bcrypt hashed passwords
- **Demo Mode:** תמיכה ב-plain text (לפיתוח בלבד)

### CORS
- מוגדר ב-`apps/api/src/main.ts`
- מאפשר רק origins מורשים

---

## 📊 סיכום טבלה

| אזור | גישה | רמות הרשאה | פונקציות עיקריות |
|------|------|------------|-------------------|
| **Store** | ציבורי | אין | עיון, קנייה, הזמנות |
| **Dashboard** | דורש התחברות | SUPER_ADMIN, OWNER, ADMIN, STAFF, INSTALLER | ניהול מלא |
| **Installer** | דורש התחברות | INSTALLER, OWNER, ADMIN, STAFF | ניהול התקנות בלבד |
| **SuperAdmin** | דורש התחברות | SUPER_ADMIN בלבד | ניהול מערכת |

---

## 🎯 המלצות לשימוש

### למשתמש רגיל (לקוח)
- גש ל-`/store` - עיין וקנה
- אין צורך בהתחברות

### לבעלים/מנהל
- התחבר עם OWNER/ADMIN role
- גש ל-`/` - דשבורד ניהול מלא
- **Default:** `owner1@demo.local` / `changeme`

### למתקין
- התחבר עם INSTALLER role
- גש ל-`/installer` - לוח זמנים והתקנות
- **צריך ליצור משתמש עם role: INSTALLER**

### למנהל מערכת
- התחבר עם SUPER_ADMIN role
- גש ל-`/superadmin` - ניהול מערכת
- **Default:** `super@platform.local` / `changeme`

---

## 📝 הערות חשובות

### Demo Mode
- כל הפונקציות תומכות ב-demo mode לבדיקות ופיתוח
- ב-demo mode, סיסמאות יכולות להיות plain text
- ב-production, רק bcrypt hashed passwords

### Multi-Tenant
- כל משתמש שייך ל-company אחת
- לא ניתן לגשת לנתונים של חברות אחרות
- SUPER_ADMIN יכול לגשת לכל החברות

### Security
- כל ה-API endpoints מוגנים ב-JWT
- Tenant isolation מובנה בכל ה-queries
- CORS מוגדר להגנה מפני cross-origin attacks

